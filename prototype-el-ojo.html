<!DOCTYPE html>
<html lang="es">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WN2HNWS6');</script>
  <!-- End Google Tag Manager -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RESONANT MIGRATION — EL OJO</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
  <style>
    :root {
      --void:        #080808;
      --charcoal:    #1c1c1c;
      --concrete:    #363636;
      --text:        #e0e0e0;
      --text-dim:    #606060;
      --eye-core:    #d4811f;
      --eye-mid:     #8a4f0f;
      --eye-dark:    #3d2200;
      --accent:      #39ff14;
      --accent-dim:  rgba(57, 255, 20, 0.35);
      --danger:      #ff2020;
      --cold:        #00aaff;
      --glow:        rgba(212, 129, 31, 0.18);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%; height: 100%;
      background: var(--void);
      color: var(--text);
      font-family: 'IBM Plex Mono', monospace;
      overflow: hidden;
      cursor: none;
      user-select: none;
    }

    /* ─── Custom Cursor ─── */
    #cursor {
      position: fixed;
      width: 22px; height: 22px;
      pointer-events: none;
      z-index: 99999;
      transform: translate(-50%, -50%);
    }
    #cursor::before {
      content: '';
      display: block;
      width: 100%; height: 100%;
      border: 1px solid var(--eye-core);
      border-radius: 50%;
      animation: cursorPulse 2.5s ease-in-out infinite;
    }
    #cursor::after {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      width: 4px; height: 4px;
      background: var(--eye-core);
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }
    @keyframes cursorPulse {
      0%, 100% { opacity: 0.9; transform: scale(1); }
      50% { opacity: 0.3; transform: scale(1.3); }
    }

    /* ─── Scanlines ─── */
    #scanlines {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: repeating-linear-gradient(
        0deg, transparent, transparent 2px,
        rgba(0,0,0,0.10) 2px, rgba(0,0,0,0.10) 4px
      );
      pointer-events: none; z-index: 9001;
    }

    /* ─── Vignette ─── */
    #vignette {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(ellipse at center, transparent 35%, rgba(0,0,0,0.75) 100%);
      pointer-events: none; z-index: 9000;
    }

    /* ─── Glitch Overlay ─── */
    #glitch-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 9999; opacity: 0;
    }
    #glitch-overlay.active { animation: glitchFlash 0.45s steps(1) forwards; }
    @keyframes glitchFlash {
      0%  { opacity: 0; background: transparent; transform: translate(0); }
      10% { opacity: 1; background: rgba(212,129,31,0.06); transform: translate(3px,0); }
      20% { opacity: 0; transform: translate(0); }
      35% { opacity: 1; background: rgba(57,255,20,0.04); transform: translate(-4px,0); }
      45% { opacity: 0; transform: translate(0); }
      60% { opacity: 1; background: rgba(0,170,255,0.04); transform: translate(2px,0); }
      75% { opacity: 0; transform: translate(0); }
      100%{ opacity: 0; }
    }

    /* ─── Header ─── */
    .header-bar {
      position: fixed; top: 0; left: 0; right: 0;
      padding: 14px 24px;
      display: flex; justify-content: space-between; align-items: center;
      z-index: 10002;
      border-bottom: 1px solid var(--charcoal);
      background: rgba(8,8,8,0.6);
      backdrop-filter: blur(4px);
    }
    .header-brand {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 13px; letter-spacing: 0.25em; color: var(--text-dim);
    }
    .header-status {
      font-size: 9px; letter-spacing: 0.35em; color: var(--text-dim);
    }
    .header-status.online { color: var(--accent); }
    .header-status.loading { color: var(--eye-core); animation: statusBlink 1s step-end infinite; }
    @keyframes statusBlink { 50% { opacity: 0.3; } }

    /* ─── State Machine ─── */
    .state {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 10000; /* above all overlays */
    }
    .state.hidden { display: none; }
    @keyframes stateIn { from { opacity: 0; } to { opacity: 1; } }

    /* ─── Eye SVG Animations ─── */
    .ring-outer-group { animation: ringRotate 45s linear infinite; transform-origin: 150px 150px; }
    .ring-mid-group   { animation: ringRotate 28s linear infinite reverse; transform-origin: 150px 150px; }
    .ring-inner-group { animation: ringRotate 16s linear infinite; transform-origin: 150px 150px; }
    @keyframes ringRotate { to { transform: rotate(360deg); } }

    .iris-pulse { animation: irisPulse 3s ease-in-out infinite; }
    @keyframes irisPulse { 0%,100% { opacity: 0.85; } 50% { opacity: 1; } }

    #eye-iris-group { transition: transform 0.35s cubic-bezier(0.23, 1, 0.32, 1); }
    .pupil-shape    { transition: ry 0.6s ease, rx 0.4s ease; }

    /* ─────────────────────────────────────────
       STATE 1: ARRIVAL
    ───────────────────────────────────────── */
    #state-arrival { gap: 0; }

    .eye-wrapper {
      position: relative;
      width: 280px; height: 280px;
    }
    .eye-wrapper svg { width: 100%; height: 100%; overflow: visible; }

    .eye-prompt {
      margin-top: 36px;
      text-align: center;
    }
    .eye-title {
      font-family: 'Bebas Neue', sans-serif;
      font-size: 48px; letter-spacing: 0.06em;
      color: var(--text); line-height: 1;
      margin-bottom: 8px;
    }
    .eye-subtitle {
      font-size: 9px; letter-spacing: 0.45em;
      color: var(--text-dim); margin-bottom: 36px;
    }

    .btn-location {
      background: transparent;
      border: 1px solid var(--eye-core);
      color: var(--eye-core);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 10px; letter-spacing: 0.3em;
      padding: 14px 36px;
      cursor: pointer;
      position: relative; overflow: hidden;
      transition: letter-spacing 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    }
    .btn-location::before {
      content: '';
      position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(212,129,31,0.12), transparent);
      transition: left 0.5s ease;
    }
    .btn-location:hover::before { left: 100%; }
    .btn-location:hover {
      letter-spacing: 0.45em;
      background: rgba(212,129,31,0.07);
      box-shadow: 0 0 24px var(--glow), inset 0 0 12px rgba(212,129,31,0.05);
    }

    .ambient-strip {
      position: fixed; bottom: 24px; left: 0; right: 0;
      text-align: center; font-size: 8px;
      letter-spacing: 0.25em; color: var(--concrete);
      animation: ambientShift 5s ease-in-out infinite;
      z-index: 10001;
    }
    @keyframes ambientShift { 0%,100% { opacity: 0.4; } 50% { opacity: 0.9; } }

    /* ─────────────────────────────────────────
       STATE 2: LOADING
    ───────────────────────────────────────── */
    #state-loading { gap: 0; }

    .loading-eye-wrap {
      width: 160px; height: 160px; flex-shrink: 0;
    }
    .loading-eye-wrap svg { width: 100%; height: 100%; overflow: visible; }

    .coords-display {
      font-size: 10px; letter-spacing: 0.2em;
      color: var(--eye-core);
      margin-top: 20px; margin-bottom: 28px;
      opacity: 0; animation: fadeUp 0.5s 0.4s ease forwards;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .signals-grid {
      display: flex; flex-direction: column;
      gap: 11px; width: 300px;
    }
    .signal-row {
      display: flex; align-items: center; gap: 14px;
      opacity: 0; transform: translateX(-8px);
      animation: fadeInLeft 0.35s ease forwards;
    }
    .signal-row:nth-child(1) { animation-delay: 0.55s; }
    .signal-row:nth-child(2) { animation-delay: 0.70s; }
    .signal-row:nth-child(3) { animation-delay: 0.85s; }
    .signal-row:nth-child(4) { animation-delay: 1.00s; }
    .signal-row:nth-child(5) { animation-delay: 1.15s; }
    .signal-row:nth-child(6) { animation-delay: 1.30s; }
    @keyframes fadeInLeft {
      to { opacity: 1; transform: translateX(0); }
    }

    .signal-label {
      font-size: 8px; letter-spacing: 0.4em;
      color: var(--text-dim); width: 78px; flex-shrink: 0;
    }
    .signal-track {
      flex: 1; height: 1px;
      background: var(--charcoal);
      position: relative; overflow: visible;
    }
    .signal-fill {
      height: 100%; background: var(--eye-core);
      width: 0%; transition: width 1.6s ease;
      position: relative;
    }
    .signal-fill.done { background: var(--accent); }
    .signal-fill::after {
      content: '';
      position: absolute; right: 0; top: -3px;
      width: 6px; height: 6px; border-radius: 50%;
      background: inherit;
      box-shadow: 0 0 6px currentColor;
    }
    .signal-value {
      font-size: 8px; color: var(--text-dim);
      width: 56px; text-align: right; letter-spacing: 0.08em;
    }
    .signal-value.done { color: var(--accent); }

    /* ─────────────────────────────────────────
       STATE 3: OUTPUT
    ───────────────────────────────────────── */
    #state-output { padding: 0; }

    #art-canvas {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%; z-index: 1;
    }

    .eye-corner {
      position: fixed; top: 52px; right: 20px;
      width: 56px; height: 56px; z-index: 300;
      opacity: 0.65; transition: opacity 0.3s;
    }
    .eye-corner svg { width: 100%; height: 100%; overflow: visible; }
    .eye-corner:hover { opacity: 1; }

    /* Receipt */
    #receipt-bar {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: linear-gradient(0deg, rgba(8,8,8,0.98) 70%, rgba(8,8,8,0.80) 100%);
      border-top: 1px solid var(--charcoal);
      padding: 14px 24px 18px;
      z-index: 300;
      backdrop-filter: blur(10px);
    }
    .receipt-id {
      font-size: 8px; letter-spacing: 0.45em;
      color: var(--eye-core); margin-bottom: 8px;
    }
    .receipt-row {
      font-size: 8px; letter-spacing: 0.12em;
      color: var(--text-dim); line-height: 2;
      margin-bottom: 4px;
    }
    .receipt-row .k { color: var(--concrete); }
    .receipt-row .v { color: var(--text); }
    .receipt-row .sep { color: var(--charcoal); margin: 0 10px; }
    .receipt-hash {
      font-size: 7px; letter-spacing: 0.08em;
      color: var(--charcoal); margin-bottom: 14px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .receipt-actions { display: flex; gap: 10px; }

    .btn-act {
      background: transparent;
      border: 1px solid var(--charcoal);
      color: var(--text-dim);
      font-family: 'IBM Plex Mono', monospace;
      font-size: 8px; letter-spacing: 0.28em;
      padding: 10px 18px; cursor: pointer;
      transition: all 0.2s;
    }
    .btn-act:hover { border-color: var(--eye-core); color: var(--eye-core); }
    .btn-act.primary {
      border-color: var(--eye-core); color: var(--eye-core);
    }
    .btn-act.primary:hover {
      background: rgba(212,129,31,0.08);
      box-shadow: 0 0 18px var(--glow);
    }
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WN2HNWS6"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div id="cursor"></div>
  <div id="scanlines"></div>
  <div id="vignette"></div>
  <div id="glitch-overlay"></div>

  <!-- Header -->
  <div class="header-bar">
    <span class="header-brand">RESONANT MIGRATION</span>
    <span class="header-status" id="hstatus">● OFFLINE</span>
  </div>

  <!-- ═══════════════════════════════════════
       STATE 1 — ARRIVAL
  ═══════════════════════════════════════ -->
  <div class="state" id="state-arrival">

    <div class="eye-wrapper">
      <svg id="eye-svg-1" viewBox="0 0 300 300">
        <defs>
          <radialGradient id="ig1" cx="50%" cy="38%" r="60%">
            <stop offset="0%"  stop-color="#ffdd88"/>
            <stop offset="25%" stop-color="#d4811f"/>
            <stop offset="65%" stop-color="#7a3a06"/>
            <stop offset="100%" stop-color="#180700"/>
          </radialGradient>
          <radialGradient id="pg1" cx="50%" cy="32%" r="52%">
            <stop offset="0%"  stop-color="#0d0500"/>
            <stop offset="100%" stop-color="#000000"/>
          </radialGradient>
          <filter id="eglow1" x="-60%" y="-60%" width="220%" height="220%">
            <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="b"/>
            <feColorMatrix in="b" type="matrix"
              values="1.2 0.5 0 0 0  0.6 0.3 0 0 0  0 0 0 0 0  0 0 0 0.5 0" result="g"/>
            <feMerge><feMergeNode in="g"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
          <clipPath id="iclip1">
            <ellipse cx="150" cy="150" rx="53" ry="100"/>
          </clipPath>
        </defs>

        <!-- Outer ring -->
        <g class="ring-outer-group">
          <circle cx="150" cy="150" r="142" fill="none" stroke="#1a1a1a" stroke-width="1"/>
          <line x1="150" y1="8"   x2="150" y2="20"  stroke="#2a2a2a" stroke-width="1"/>
          <line x1="150" y1="280" x2="150" y2="292" stroke="#2a2a2a" stroke-width="1"/>
          <line x1="8"   y1="150" x2="20"  y2="150" stroke="#2a2a2a" stroke-width="1"/>
          <line x1="280" y1="150" x2="292" y2="150" stroke="#2a2a2a" stroke-width="1"/>
          <text x="150" y="5"   font-family="'IBM Plex Mono'" font-size="6" fill="#252525" text-anchor="middle" letter-spacing="3">RESONANT</text>
          <text x="150" y="299" font-family="'IBM Plex Mono'" font-size="6" fill="#252525" text-anchor="middle" letter-spacing="3">MIGRATION</text>
          <circle cx="44"  cy="44"  r="2" fill="#222"/>
          <circle cx="256" cy="44"  r="2" fill="#222"/>
          <circle cx="44"  cy="256" r="2" fill="#222"/>
          <circle cx="256" cy="256" r="2" fill="#222"/>
        </g>

        <!-- Mid ring -->
        <g class="ring-mid-group">
          <circle cx="150" cy="150" r="116" fill="none" stroke="#181818" stroke-width="1.5"/>
          <line x1="150" y1="34" x2="150" y2="46" stroke="#252525" stroke-width="1.5"/>
          <line x1="150" y1="254" x2="150" y2="266" stroke="#252525" stroke-width="1.5"/>
          <line x1="34"  y1="150" x2="46"  y2="150" stroke="#252525" stroke-width="1.5"/>
          <line x1="254" y1="150" x2="266" y2="150" stroke="#252525" stroke-width="1.5"/>
        </g>

        <!-- Inner ring -->
        <g class="ring-inner-group">
          <circle cx="150" cy="150" r="80" fill="none" stroke="#161616" stroke-width="1"/>
          <circle cx="150" cy="70"  r="2" fill="#282828"/>
          <circle cx="150" cy="230" r="2" fill="#282828"/>
          <circle cx="70"  cy="150" r="2" fill="#282828"/>
          <circle cx="230" cy="150" r="2" fill="#282828"/>
        </g>

        <!-- Iris glow aura -->
        <ellipse cx="150" cy="150" rx="56" ry="102" fill="rgba(212,129,31,0.05)"
          filter="url(#eglow1)" class="iris-pulse"/>

        <!-- Eye iris group — cursor-tracked -->
        <g id="eye-iris-group">
          <!-- Iris fill -->
          <ellipse cx="150" cy="150" rx="53" ry="100"
            fill="url(#ig1)" filter="url(#eglow1)" class="iris-pulse"/>

          <!-- Iris striations -->
          <g clip-path="url(#iclip1)" opacity="0.25">
            <line x1="97" y1="128" x2="203" y2="128" stroke="#ffcc66" stroke-width="0.6"/>
            <line x1="97" y1="138" x2="203" y2="138" stroke="#ffcc66" stroke-width="0.6"/>
            <line x1="97" y1="148" x2="203" y2="148" stroke="#ffcc66" stroke-width="0.5"/>
            <line x1="97" y1="158" x2="203" y2="158" stroke="#ffcc66" stroke-width="0.6"/>
            <line x1="97" y1="168" x2="203" y2="168" stroke="#ffcc66" stroke-width="0.6"/>
          </g>

          <!-- Pupil -->
          <ellipse id="pupil-1" cx="150" cy="150" rx="17" ry="54"
            fill="url(#pg1)" class="pupil-shape"/>

          <!-- Catchlights -->
          <ellipse cx="142" cy="116" rx="7" ry="10" fill="rgba(255,220,160,0.22)"/>
          <ellipse cx="144" cy="113" rx="3" ry="4"  fill="rgba(255,255,255,0.14)"/>
        </g>

        <!-- Eyelid shadow top/bottom -->
        <ellipse cx="150" cy="55"  rx="90" ry="40" fill="var(--void)" opacity="0.85"/>
        <ellipse cx="150" cy="245" rx="90" ry="40" fill="var(--void)" opacity="0.85"/>
      </svg>
    </div>

    <div class="eye-prompt">
      <div class="eye-title">EL OJO QUIERE VERTE</div>
      <div class="eye-subtitle">SISTEMA DE OBSERVACIÓN ACTIVO · EL OJO v5.0</div>
      <button class="btn-location" id="btn-grant">[ COMPARTIR UBICACIÓN ]</button>
    </div>

    <div class="ambient-strip" id="ambient">
      SIG_WAIT · ??°N · ??°E · KP:— · TONE:— · SEIS:— · ATN:—
    </div>
  </div>

  <!-- ═══════════════════════════════════════
       STATE 2 — LOADING
  ═══════════════════════════════════════ -->
  <div class="state hidden" id="state-loading">

    <div class="loading-eye-wrap">
      <svg viewBox="0 0 300 300">
        <defs>
          <radialGradient id="ig2" cx="50%" cy="38%" r="60%">
            <stop offset="0%"  stop-color="#ffdd88"/>
            <stop offset="35%" stop-color="#d4811f"/>
            <stop offset="100%" stop-color="#180700"/>
          </radialGradient>
          <filter id="eglow2" x="-60%" y="-60%" width="220%" height="220%">
            <feGaussianBlur stdDeviation="10" result="b"/>
            <feColorMatrix in="b" type="matrix"
              values="1.2 0.5 0 0 0  0.6 0.3 0 0 0  0 0 0 0 0  0 0 0 0.5 0" result="g"/>
            <feMerge><feMergeNode in="g"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>
        <g style="animation: ringRotate 45s linear infinite; transform-origin: 150px 150px">
          <circle cx="150" cy="150" r="142" fill="none" stroke="#1a1a1a" stroke-width="1"/>
        </g>
        <g style="animation: ringRotate 28s linear infinite reverse; transform-origin: 150px 150px">
          <circle cx="150" cy="150" r="116" fill="none" stroke="#181818" stroke-width="1.5"/>
        </g>
        <ellipse cx="150" cy="150" rx="53" ry="100"
          fill="url(#ig2)" filter="url(#eglow2)"
          style="animation: irisPulse 2s ease-in-out infinite"/>
        <ellipse id="pupil-load" cx="150" cy="150" rx="17" ry="54"
          fill="#060200" style="transition: ry 0.6s ease"/>
      </svg>
    </div>

    <div class="coords-display" id="coords-txt">LOCALIZANDO...</div>

    <div class="signals-grid">
      <div class="signal-row">
        <span class="signal-label">CLIMA</span>
        <div class="signal-track"><div class="signal-fill" id="f-clima"></div></div>
        <span class="signal-value" id="v-clima">···</span>
      </div>
      <div class="signal-row">
        <span class="signal-label">EVENTOS</span>
        <div class="signal-track"><div class="signal-fill" id="f-eventos"></div></div>
        <span class="signal-value" id="v-eventos">···</span>
      </div>
      <div class="signal-row">
        <span class="signal-label">COSMOS</span>
        <div class="signal-track"><div class="signal-fill" id="f-cosmos"></div></div>
        <span class="signal-value" id="v-cosmos">···</span>
      </div>
      <div class="signal-row">
        <span class="signal-label">ECONOMÍA</span>
        <div class="signal-track"><div class="signal-fill" id="f-economia"></div></div>
        <span class="signal-value" id="v-economia">···</span>
      </div>
      <div class="signal-row">
        <span class="signal-label">ATENCIÓN</span>
        <div class="signal-track"><div class="signal-fill" id="f-atencion"></div></div>
        <span class="signal-value" id="v-atencion">···</span>
      </div>
      <div class="signal-row">
        <span class="signal-label">TIERRA</span>
        <div class="signal-track"><div class="signal-fill" id="f-tierra"></div></div>
        <span class="signal-value" id="v-tierra">···</span>
      </div>
    </div>
  </div>

  <!-- ═══════════════════════════════════════
       STATE 3 — OUTPUT
  ═══════════════════════════════════════ -->
  <div class="state hidden" id="state-output">

    <canvas id="art-canvas"></canvas>

    <!-- Eye mini corner -->
    <div class="eye-corner">
      <svg viewBox="0 0 300 300">
        <defs>
          <radialGradient id="ig3" cx="50%" cy="38%" r="60%">
            <stop offset="0%"  stop-color="#ffdd88"/>
            <stop offset="35%" stop-color="#d4811f"/>
            <stop offset="100%" stop-color="#180700"/>
          </radialGradient>
          <filter id="eglow3" x="-60%" y="-60%" width="220%" height="220%">
            <feGaussianBlur stdDeviation="10" result="b"/>
            <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>
        <g style="animation: ringRotate 45s linear infinite; transform-origin:150px 150px">
          <circle cx="150" cy="150" r="142" fill="none" stroke="#1a1a1a" stroke-width="1"/>
        </g>
        <ellipse cx="150" cy="150" rx="53" ry="100"
          fill="url(#ig3)" filter="url(#eglow3)"
          style="animation: irisPulse 3s ease-in-out infinite"/>
        <ellipse cx="150" cy="150" rx="17" ry="54" fill="#060200"/>
      </svg>
    </div>

    <!-- Receipt -->
    <div id="receipt-bar">
      <div class="receipt-id" id="r-id">AUSGABE #00042 · EL OJO v5.0</div>
      <div class="receipt-row">
        <span class="k">COORDS</span><span class="sep">·</span>
        <span class="v" id="r-coords">19.4326° N · 99.1332° W · CIUDAD DE MÉXICO</span>
        <span class="sep">  </span>
        <span class="k">TIMESTAMP</span><span class="sep">·</span>
        <span class="v" id="r-time">2026-02-21T15:14:07Z</span>
      </div>
      <div class="receipt-row" id="receipt-data-row">
        <span class="k">TEMP</span><span class="sep">·</span><span class="v">—</span>
        <span class="sep">  </span>
        <span class="k">VIENTO</span><span class="sep">·</span><span class="v">—</span>
        <span class="sep">  </span>
        <span class="k">KP</span><span class="sep">·</span><span class="v">—</span>
        <span class="sep">  </span>
        <span class="k">TONO</span><span class="sep">·</span><span class="v">—</span>
        <span class="sep">  </span>
        <span class="k">SÍSM</span><span class="sep">·</span><span class="v">—</span>
        <span class="sep">  </span>
        <span class="k">ATN</span><span class="sep">·</span><span class="v">—</span>
      </div>
      <div class="receipt-hash" id="r-hash">
        SHA256: a3f9b2e178c45d091f3b6e8a2c74d091f3b6e8a2c74d091f3b6e8a2c74d091f
      </div>
      <div class="receipt-actions">
        <button class="btn-act primary">↓ DESCARGAR</button>
        <button class="btn-act" id="btn-new">⟳ NUEVA VISIÓN</button>
        <button class="btn-act">⇗ COMPARTIR</button>
      </div>
    </div>
  </div>

  <script>
    // ─── Helpers ─────────────────────────────────
    function degToCompass(d) {
      return ['N','NE','E','SE','S','SO','O','NO'][Math.round((d||0)/45) % 8];
    }
    function getYesterdayPath() {
      const d = new Date(); d.setDate(d.getDate()-1);
      return `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}`;
    }
    function haversineKm(lat1, lon1, lat2, lon2) {
      const R=6371, dL=(lat2-lat1)*Math.PI/180, dl=(lon2-lon1)*Math.PI/180;
      const a=Math.sin(dL/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dl/2)**2;
      return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
    }
    function animBar(id, dur) {
      const b = document.getElementById(`f-${id}`); if (!b) return;
      b.style.width='0%';
      requestAnimationFrame(() => { b.style.transition=`width ${dur}ms ease`; b.style.width='100%'; });
    }
    function markSignal(id, text, kpStep) {
      const b=document.getElementById(`f-${id}`), v=document.getElementById(`v-${id}`);
      const p=document.getElementById('pupil-load');
      if (b) b.classList.add('done');
      if (v) { v.textContent=text; v.classList.add('done'); }
      if (p) p.setAttribute('ry', 54+(kpStep+1)*7);
    }

    // ─── Cursor ───────────────────────────────────
    const $cursor = document.getElementById('cursor');
    let mx = window.innerWidth/2, my = window.innerHeight/2;

    document.addEventListener('mousemove', e => {
      mx = e.clientX; my = e.clientY;
      $cursor.style.left = mx + 'px';
      $cursor.style.top  = my + 'px';
      trackEye();
    });

    // ─── Eye Tracking ────────────────────────────
    function trackEye() {
      const wrap = document.getElementById('state-arrival');
      if (wrap.classList.contains('hidden')) return;
      const svg = document.getElementById('eye-svg-1');
      if (!svg) return;
      const r = svg.getBoundingClientRect();
      const cx = r.left + r.width  / 2;
      const cy = r.top  + r.height / 2;
      const dx = mx - cx, dy = my - cy;
      const d  = Math.sqrt(dx*dx + dy*dy) || 1;
      const ox = (dx/d) * Math.min(d * 0.07, 11);
      const oy = (dy/d) * Math.min(d * 0.05, 8);
      const ig = document.getElementById('eye-iris-group');
      if (ig) ig.style.transform = `translate(${ox}px, ${oy}px)`;
    }

    // ─── Ambient data loop ────────────────────────
    const ambients = [
      'SIG_WAIT · ??°N · ??°E · KP:— · TONE:— · SEIS:— · ATN:—',
      'AWAITING INPUT · SYSTEM IDLE · LOCATION: NULL · STANDBY',
      'EL OJO OBSERVA · SEÑALES: 6 · ESTADO: EN ESPERA · v5.0',
      'INSERT LOCATION · WIRD GENERIERT · OBSERVACIÓN ACTIVA',
    ];
    let ai = 0;
    setInterval(() => {
      ai = (ai + 1) % ambients.length;
      const el = document.getElementById('ambient');
      if (el) el.textContent = ambients[ai];
    }, 3200);

    // ─── Glitch ───────────────────────────────────
    function glitch(cb) {
      const o = document.getElementById('glitch-overlay');
      o.classList.add('active');
      setTimeout(() => { o.classList.remove('active'); if (cb) cb(); }, 450);
    }

    // ─── Show state ───────────────────────────────
    function showState(id) {
      document.querySelectorAll('.state').forEach(s => s.classList.add('hidden'));
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.remove('hidden');
      el.style.animation = 'none';
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          el.style.animation = 'stateIn 0.45s ease forwards';
        });
      });
    }

    // ─── Btn: Grant Location ──────────────────────
    document.getElementById('btn-grant').addEventListener('click', () => {
      glitch(() => {
        showState('state-loading');
        const hs = document.getElementById('hstatus');
        hs.textContent = '● LEYENDO';
        hs.className = 'header-status loading';
        runLoading();
      });
    });

    // ─── Loading Sequence — REAL APIS ─────────────
    async function runLoading() {
      const coordsEl = document.getElementById('coords-txt');

      // 1) Geolocation
      let lat = 19.4326, lng = -99.1332;
      try {
        const pos = await new Promise((res, rej) =>
          navigator.geolocation.getCurrentPosition(res, rej, { timeout: 6000 })
        );
        lat = pos.coords.latitude;
        lng = pos.coords.longitude;
      } catch(e) { /* use CDMX default */ }

      if (coordsEl) coordsEl.textContent =
        `${Math.abs(lat).toFixed(4)}° ${lat>=0?'N':'S'} · ${Math.abs(lng).toFixed(4)}° ${lng>=0?'E':'O'}`;

      // World state object — filled as APIs resolve
      const ws = { lat, lng, temp:20, wind:10, windDir:0, uv:3,
                   kp:2, volatility:15, tone:-5,
                   topArticle:'—', seismic:0, seismicDist:0 };

      // 2) Fire all 5 APIs in parallel
      const [climaR, cosmosR, econR, atnR, tierraR] = await Promise.allSettled([
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current=temperature_2m,wind_speed_10m,wind_direction_10m,uv_index`).then(r=>r.json()),
        fetch('https://services.swpc.noaa.gov/json/planetary_k_index_1m.json').then(r=>r.json()),
        fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10').then(r=>r.json()),
        fetch(`https://wikimedia.org/api/rest_v1/metrics/pageviews/top/en.wikipedia/all-access/${getYesterdayPath()}`).then(r=>r.json()),
        fetch('https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson').then(r=>r.json()),
      ]);

      // 3) Process each signal with staggered visual reveals
      const delay = ms => new Promise(r => setTimeout(r, ms));

      // CLIMA
      animBar('clima', 900);
      await delay(1000);
      if (climaR.status === 'fulfilled') {
        const c = climaR.value.current || {};
        ws.temp    = c.temperature_2m   ?? 20;
        ws.wind    = c.wind_speed_10m   ?? 10;
        ws.windDir = c.wind_direction_10m ?? 0;
        ws.uv      = c.uv_index         ?? 3;
        markSignal('clima', `${Math.round(ws.temp)}°C ${degToCompass(ws.windDir)}`, 0);
      } else { markSignal('clima', 'NO SIGNAL', 0); }

      // COSMOS
      animBar('cosmos', 700);
      await delay(800);
      if (cosmosR.status === 'fulfilled') {
        const arr = cosmosR.value;
        ws.kp = parseFloat(arr[arr.length-1]?.[1]) || 2;
        markSignal('cosmos', `KP:${ws.kp.toFixed(1)}`, 1);
      } else { markSignal('cosmos', 'NO SIGNAL', 1); }

      // ECONOMÍA
      animBar('economia', 900);
      await delay(1000);
      if (econR.status === 'fulfilled') {
        const coins = econR.value || [];
        const changes = coins.map(c => Math.abs(c.price_change_percentage_24h || 0));
        ws.volatility = changes.reduce((a,b)=>a+b,0) / Math.max(changes.length,1);
        markSignal('economia', `VOL:${ws.volatility.toFixed(1)}%`, 2);
      } else { markSignal('economia', 'NO SIGNAL', 2); }

      // ATENCIÓN
      animBar('atencion', 800);
      await delay(900);
      if (atnR.status === 'fulfilled') {
        const arts = atnR.value?.items?.[0]?.articles || [];
        // skip "Main_Page" and "Special:*"
        const top = arts.find(a => !a.article.startsWith('Main_') && !a.article.startsWith('Special:'));
        ws.topArticle = (top?.article || arts[0]?.article || '—').replace(/_/g,' ');
        markSignal('atencion', ws.topArticle.substring(0,12).toUpperCase(), 3);
      } else { markSignal('atencion', 'NO SIGNAL', 3); }

      // TIERRA
      animBar('tierra', 800);
      await delay(900);
      if (tierraR.status === 'fulfilled') {
        const feats = tierraR.value?.features || [];
        if (feats.length > 0) {
          let nearest = null, minD = Infinity;
          feats.forEach(f => {
            const [eLng, eLat] = f.geometry?.coordinates || [0,0];
            const d = haversineKm(lat, lng, eLat, eLng);
            if (d < minD) { minD = d; nearest = f; }
          });
          ws.seismic     = nearest?.properties?.mag || 0;
          ws.seismicDist = Math.round(minD);
          markSignal('tierra', `M${ws.seismic.toFixed(1)} ${ws.seismicDist}km`, 4);
        } else { ws.seismic = 0; markSignal('tierra', 'QUIET', 4); }
      } else { markSignal('tierra', 'NO SIGNAL', 4); }

      // EVENTOS — derived from available signals (GDELT blocked by CORS in browser)
      animBar('eventos', 600);
      await delay(700);
      ws.tone = -((ws.volatility * 0.6) + (ws.kp * 1.8));
      markSignal('eventos', `TONO:${ws.tone.toFixed(1)}`, 5);

      // 4) Transition to output
      await delay(600);
      glitch(() => {
        showState('state-output');
        document.getElementById('hstatus').textContent = '● EN VIVO';
        document.getElementById('hstatus').className = 'header-status online';
        initCanvas(ws);
        stampReceipt(ws);
      });
    }

    // ─── Receipt stamp ───────────────────────────
    let lastWS = null;
    function stampReceipt(ws) {
      if (ws) lastWS = ws;
      const w = lastWS || { lat:0, lng:0, temp:20, wind:10, windDir:0,
                            kp:2, tone:-5, volatility:15,
                            seismic:0, seismicDist:0, topArticle:'—' };
      const n = String(Math.floor(Math.random()*99999)).padStart(5,'0');
      document.getElementById('r-id').textContent = `AUSGABE #${n} · EL OJO v5.0`;
      document.getElementById('r-time').textContent = new Date().toISOString().split('.')[0]+'Z';
      document.getElementById('r-coords').textContent =
        `${Math.abs(w.lat).toFixed(4)}° ${w.lat>=0?'N':'S'} · ${Math.abs(w.lng).toFixed(4)}° ${w.lng>=0?'E':'O'}`;

      // Dynamic data row
      const row = document.getElementById('receipt-data-row');
      if (row) row.innerHTML =
        `<span class="k">TEMP</span><span class="sep">·</span><span class="v">${Math.round(w.temp)}°C</span>
         <span class="sep">  </span>
         <span class="k">VIENTO</span><span class="sep">·</span><span class="v">${Math.round(w.wind)}km/h ${degToCompass(w.windDir)}</span>
         <span class="sep">  </span>
         <span class="k">KP</span><span class="sep">·</span><span class="v">${w.kp.toFixed(1)}</span>
         <span class="sep">  </span>
         <span class="k">TONO</span><span class="sep">·</span><span class="v">${w.tone.toFixed(1)}</span>
         <span class="sep">  </span>
         <span class="k">SÍSM</span><span class="sep">·</span><span class="v">${w.seismic>0?`M${w.seismic.toFixed(1)} (${w.seismicDist}km)`:'QUIET'}</span>
         <span class="sep">  </span>
         <span class="k">ATN</span><span class="sep">·</span><span class="v">${w.topArticle.substring(0,18).toUpperCase()}</span>`;

      const hash = Array.from({length:64},()=>'0123456789abcdef'[Math.floor(Math.random()*16)]).join('');
      document.getElementById('r-hash').textContent = `SHA256: ${hash}`;
    }

    // ─── Nueva visión ────────────────────────────
    document.getElementById('btn-new').addEventListener('click', () => {
      glitch(() => { if (lastWS) { restartCanvas(); stampReceipt(); } });
    });

    // ─── Generative Art Canvas ───────────────────
    let raf, pts = [];

    function initCanvas(ws) {
      if (!ws) ws = lastWS || { temp:20, wind:10, kp:2, tone:-5, volatility:15, seismic:0 };
      const c = document.getElementById('art-canvas');
      const ctx = c.getContext('2d');
      c.width  = window.innerWidth;
      c.height = window.innerHeight;

      // Derived parameters
      const speed      = 0.4 + (ws.wind / 100);
      const storminess = ws.kp / 9;
      const chaos      = ws.volatility / 100;
      const warmth     = Math.max(0, Math.min(1, (ws.temp + 10) / 60));

      pts = Array.from({length: 350}, () => ({
        x:  Math.random() * c.width,
        y:  Math.random() * c.height,
        vx: (Math.random()-0.5) * speed,
        vy: (Math.random()-0.5) * speed,
        sz: Math.random() * 1.4 + 0.2,
        a:  Math.random() * Math.PI * 2,
        av: (Math.random()-0.5) * 0.015 * (1 + storminess),
        r:  60 + Math.random() * 220,
        ox: Math.random() * c.width,
        oy: Math.random() * c.height,
        t:  Math.random() * 100,
        // 0=amber 1=cold 2=green 3=dim
        col: Math.random() < 0.55 ? 0 :
             Math.random() < 0.6  ? 1 :
             Math.random() < 0.7  ? 2 : 3,
      }));

      function color(type, a) {
        switch(type) {
          case 0: return `rgba(${Math.round(212*warmth+180*(1-warmth))},${Math.round(129*warmth+80*(1-warmth))},31,${a})`;
          case 1: return `rgba(0,170,255,${a * 0.45})`;
          case 2: return `rgba(57,255,20,${a * 0.3})`;
          default: return `rgba(160,160,160,${a * 0.15})`;
        }
      }

      let t = 0;

      function draw() {
        t += 0.0025;

        // Background decay
        ctx.fillStyle = `rgba(8,8,8,${0.04 + chaos * 0.03})`;
        ctx.fillRect(0, 0, c.width, c.height);

        // Shockwave rings if seismic active
        if (ws.seismic > 1) {
          const sw = (t * 60) % 400;
          const sg = ctx.createRadialGradient(
            c.width/2, c.height/2, sw - 20,
            c.width/2, c.height/2, sw
          );
          sg.addColorStop(0, 'rgba(0,0,0,0)');
          sg.addColorStop(0.5, `rgba(212,129,31,${ws.seismic * 0.012})`);
          sg.addColorStop(1, 'rgba(0,0,0,0)');
          ctx.fillStyle = sg;
          ctx.fillRect(0, 0, c.width, c.height);
        }

        // Update and draw particles
        pts.forEach(p => {
          p.t += 0.003;
          p.a += p.av + Math.sin(t * 2.2 + p.t) * 0.004 * storminess;

          const tx = p.ox + Math.cos(p.a) * p.r;
          const ty = p.oy + Math.sin(p.a * 0.65) * p.r * 0.55;

          p.x += (tx - p.x) * 0.003 + p.vx;
          p.y += (ty - p.y) * 0.003 + p.vy;
          p.vx += (Math.random()-0.5) * 0.008 * (1 + chaos);
          p.vy += (Math.random()-0.5) * 0.008 * (1 + chaos);
          p.vx *= 0.992; p.vy *= 0.992;

          const alpha = Math.sin(p.t * 0.8) * 0.5 + 0.5;

          ctx.beginPath();
          ctx.arc(p.x, p.y, p.sz, 0, Math.PI * 2);
          ctx.fillStyle = color(p.col, alpha * 0.75);
          ctx.fill();
        });

        // Connection lines (amber cluster)
        const ambs = pts.filter(p => p.col === 0 && p.sz > 1);
        for (let i = 0; i < ambs.length; i++) {
          for (let j = i+1; j < Math.min(i+8, ambs.length); j++) {
            const dx = ambs[i].x - ambs[j].x;
            const dy = ambs[i].y - ambs[j].y;
            const d  = Math.sqrt(dx*dx + dy*dy);
            if (d < 90) {
              ctx.beginPath();
              ctx.moveTo(ambs[i].x, ambs[i].y);
              ctx.lineTo(ambs[j].x, ambs[j].y);
              ctx.strokeStyle = `rgba(212,129,31,${(1-d/90)*0.07})`;
              ctx.lineWidth = 0.5;
              ctx.stroke();
            }
          }
        }

        // Center glow pulse
        const cg = ctx.createRadialGradient(
          c.width/2, c.height/2, 0,
          c.width/2, c.height/2, 280
        );
        cg.addColorStop(0, `rgba(212,129,31,${0.015 + Math.sin(t)*0.008})`);
        cg.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = cg;
        ctx.fillRect(0, 0, c.width, c.height);

        // High-KP storm overlay
        if (ws.kp > 5) {
          ctx.fillStyle = `rgba(57,255,20,${(ws.kp-5)/9 * 0.02 * (0.5+Math.sin(t*3)*0.5)})`;
          ctx.fillRect(0, 0, c.width, c.height);
        }

        raf = requestAnimationFrame(draw);
      }

      if (raf) cancelAnimationFrame(raf);
      ctx.fillStyle = '#080808';
      ctx.fillRect(0, 0, c.width, c.height);
      draw();
    }

    function restartCanvas() {
      if (raf) cancelAnimationFrame(raf);
      initCanvas(lastWS);
    }

    window.addEventListener('resize', () => {
      const c = document.getElementById('art-canvas');
      if (c && !document.getElementById('state-output').classList.contains('hidden')) {
        c.width  = window.innerWidth;
        c.height = window.innerHeight;
      }
    });
  </script>
</body>
</html>
